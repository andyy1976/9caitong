define("new/js/mod/email_step",["new/css/layer.css","$","layer","new/js/mod/util/sendPhoneCode","new/js/mod/util/checkEmail"],function(e){function a(){clearTimeout(s),t>0?(s=setTimeout(a,1e3),l("#get_emregsms_code").val("获取验证码"+t),l("#get_emregsms_code").addClass("btn_disable"),t--):(n=!1,l("#get_emregsms_code").removeClass("btn_disable"),l("#get_emregsms_code").val("重新获取验证码"),t=0)}e("new/css/layer.css");var l=e("$"),i=e("layer"),s=(e("new/js/mod/util/sendPhoneCode").sendPhoneCode,null),n=!1,t=0,o=l("#bind_email").attr("isemail"),r=e("new/js/mod/util/checkEmail").checkEmail;l("#get_emregsms_code").click(function(){if(n||l(this).hasClass(".btn_disable"))return!1;i.load(1),n=!0;var e="/index.php?ctl=ajax&act=get_email_verifys",s=new Object;s.user_email=""==l("#new_email").val()?l("#old_email").val():l("#new_email").val(),s.old_user_email=l("#old_email").val(),l.ajax({url:e,data:s,type:"POST",dataType:"json",success:function(e){return i.closeAll("loading"),1!=e.status?(n=!1,i.alert(e.info),!1):(t=60,a(),to_send_msg=!0,i.alert(e.info),void 0)},error:function(){return i.closeAll("loading"),i.alert("请求数据失败！",{title:"错误",icon:2}),!1}})}),l("#old_email").bind("blur",function(){var e=l(this);if(!r(e.val()))return l("#get_emregsms_code").addClass("btn_disable"),!1;i.load(1);var a="/index.php?ctl=ajax&act=check_field",s=new Object;s.field_name="email",s.field_data=l.trim(e.val()),l.ajax({url:a,data:s,type:"POST",dataType:"json",success:function(e){return i.closeAll("loading"),1==e.status?(l("#get_emregsms_code").removeClass("btn_disable"),!1):(formError(l("#signup-email-address"),e.info),!1)},error:function(){return i.closeAll("loading"),i.alert("请求数据失败！",{title:"错误",icon:2}),!1}})}),l("#new_email").bind("blur",function(){var e=l(this);if(0==l.trim(e.val()).length)return r(l("#old_email").val())?l("#get_emregsms_code").removeClass("btn_disable"):l("#get_emregsms_code").addClass("btn_disable"),!1;if(!r(e.val()))return l("#get_emregsms_code").addClass("btn_disable"),!1;i.load(1);var a="/index.php?ctl=ajax&act=check_field",s=new Object;s.field_name="email",s.field_data=l.trim(e.val()),l.ajax({url:a,data:s,type:"POST",dataType:"json",success:function(e){return i.closeAll("loading"),1==e.status?(l("#get_emregsms_code").removeClass("btn_disable"),!1):(formError(l("#signup-email-address"),e.info),!1)},error:function(){return i.closeAll("loading"),i.alert("请求数据失败！",{title:"错误",icon:2}),!1}})}),l("#new_email-submit").unbind("click"),l("#new_email-submit").bind("click",function(){if(o){if(0==l.trim(l("#old_email").val()).length)return l.showErr("请输入原邮箱",function(){l("#old_email").focus()}),!1;if(!r(l("#old_email").val()))return l.showErr("原邮箱格式错误",function(){l("#old_email").focus()}),!1}if(o){if(l.trim(l("#new_email").val()).length>0&&!r(l("#new_email").val()))return l.showErr("新邮箱格式错误",function(){l("#new_email").focus()}),!1}else if(!l.checkEmail(l("#new_email").val()))return l.showErr("新邮箱格式错误",function(){l("#new_email").focus()}),!1;i.load(1);var e=new Object;e.is_ajax=1,e.oemail=l.trim(l("#old_email").val()),e.email=l.trim(l("#new_email").val()),e.code=l("#emsms_code").val();var a=e.oemail;""!=e.email&&(a=e.email),l.ajax({url:'{url x="index" r="uc_account#saveemail"}',data:e,type:"post",dataType:"json",success:function(e){l.showSuccess(e.info),window.location.reload()},error:function(){l.showErr("请求数据失败!")}})})});