define("new/js/page/deal",["$","layer","new/js/mod/login","new/js/mod/viceNav","new/js/mod/goTop","new/js/mod/deal_slider","new/js/mod/util/jquery.prettyphoto","new/js/mod/util/OnlyNum","new/js/mod/util/FW_Password","new/js/mod/util/lang","new/js/mod/slipTab"],function(e){var t=e("$"),l=e("layer");e("new/js/mod/login"),e("new/js/mod/viceNav"),e("new/js/mod/goTop"),e("new/js/mod/deal_slider"),e("new/js/mod/util/jquery.prettyphoto"),e("new/js/mod/util/OnlyNum");{var a=(e("new/js/mod/util/FW_Password").FW_Password,e("new/js/mod/util/lang").lang),i=e("new/js/mod/slipTab");new i(".project_bd",390)}t(".project_bd").find("tr:even").css({background:"#f7f7f7"}),t(document).ready(function(){function e(){var e=0;t("#select_bonus li").each(function(){t(this).hasClass("selected")&&(e+=parseInt(t(this).attr("quota")))}),t("#on_RedEnvelope").html(e)}function i(e){if(t("#rebate").html())var l=parseFloat(t.trim(t("#rate").html()))+parseFloat(t.trim(t("#rebate").html()));else var l=parseFloat(t.trim(t("#rate").html()));var a=parseFloat(t.trim(t("#term").html())),i=0;if(1==e){var n=Math.floor(t.trim(t("#experience_money").val()));"1"==t("#term").attr("termUnit")?i=n*(l/100)/365*a:"2"==t("#term").attr("termUnit")&&(i=n*(l/100)/12*a)}else{var n=Math.floor(t.trim(t("#J_BIDMONEY").val())),s=Math.floor(t.trim(t("#RedEnvelope").val()))?Math.floor(t.trim(t("#RedEnvelope").val())):0,o=0;"1"==t("#term").attr("termUnit")?o=(n+s)*(l/100)/365*a:"2"==t("#term").attr("termUnit")&&(o=(n+s)*(l/100)/12*a);var r=0;t("#PlusInterest").val()&&(r=(n+s)*(l/100)/365*a),i=o+r}isNaN(i)&&(i=0),t("#E_Profit").html("¥"+i.toFixed(2))}function n(){var e=(d-r)/1e3;if(e>0){var l=Math.floor(e%60),a=Math.floor(e/60%60),i=Math.floor(e/3600);t("#Countdown").html("距开始还有："+i+"小时"+a+"分"+l+"秒")}else t("#Countdown").hide(),t(".submit_invest").removeClass("noBegin").attr("id","deal_submit").val("立即出借");r+=1e3,setTimeout(n,1e3)}t("#J_BIDMONEY").OnlyNum(function(){i()}),t("#J_BIDMONEY").blur(function(){if(isNaN(t("#J_BIDMONEY").val()))l.tips("输入错误","#J_BIDMONEY",{tips:1}),t("#J_BIDMONEY").focus(),t("#J_BIDMONEY").val("");else{var e=Math.floor(t.trim(t("#J_BIDMONEY").val()));if(0==e)t("#J_BIDMONEY").val("");else{var a=Math.floor(t.trim(t("#max_money").html().replace(/[^0-9]/gi,""))),n=Math.floor(t.trim(t("#J_balance").val())),s=Math.min(a,n);e>s&&(a>=n?(t("#J_BIDMONEY").val(n),l.tips("账户余额不足","#J_BIDMONEY",{tips:1})):(t("#J_BIDMONEY").val(a),l.tips("超出可投金额","#J_BIDMONEY",{tips:1})))}}i()}),t("#J_BIDMONEY").change(function(){t("#RedPackets").val(""),t("#RedPackets_id").val(""),t("#PlusCard").val(""),t("#PlusCard_id").val("")}),t("#closeLayer").live("click",function(){l.closeAll(),isclick=!1,eisclick=!1});var s=!1;t("#RedEnvelope").live("click",function(){if(s)return!1;if(s=!0,!(""!=t("#J_BIDMONEY").val()&&t("#J_BIDMONEY").val()>0))return l.tips("请填写出借金额","#J_BIDMONEY",{tips:1}),s=!1,t("#J_BIDMONEY").focus(),l.close(index),!1;l.load(1);var i=new Object;i.bid_money=t.trim(t("#J_BIDMONEY").val()),t("#deal_id").val()?i.deal_id=t.trim(t("#deal_id").val()):i.plan_id=t.trim(t("#plan_id").val()),i.RedPacket_money=t.trim(t("#RedPackets").val()),i.r_id=t.trim(t("#RedPackets_id").val()),t.ajax({url:"/index.php?ctl=deal&act=red_envelope",data:i,dataType:"json",type:"POST",success:function(a){if(l.closeAll("loading"),a.status){l.open({type:1,area:["598px","500px"],title:"选择红包",closeBtn:!1,content:a.page});var i=Math.floor(parseInt(t("#J_BIDMONEY").val()));t("#max_RedEnvelope").html(i),e(),s=!1}else l.alert(a.info,{title:"提示",closeBtn:0}),s=!1},error:function(){l.closeAll("loading"),l.alert(a.REQUEST_DATA_FAILED,{title:"提示",closeBtn:0}),s=!1}})}),t("#select_bonus li").live("click",function(){var a=parseInt(t(this).attr("quota"));if(t(this).hasClass("selected"))t(this).find(".mark").addClass("hide"),t(this).removeClass("selected"),e();else{if(!(a+parseInt(t("#on_RedEnvelope").html())<=parseInt(t("#max_RedEnvelope").html())))return l.alert("已超可使用最大额",{title:"提示",closeBtn:0}),!1;t(this).addClass("selected"),t(this).find(".mark").removeClass("hide"),e()}}),t("#confirm_bonusMoney").live("click",function(){var e="",a=0;t("#select_bonus li").each(function(){t(this).hasClass("selected")&&(e+=t(this).attr("id")+",",a+=parseInt(t(this).attr("money")))}),a>0?(t("#RedEnvelope_id").val(e.substring(0,e.length-1)),t("#RedEnvelope").val(a),l.closeAll()):(t("#RedEnvelope_id").val(""),t("#RedEnvelope").val(""),l.closeAll()),s=!1,i()});var o=!1;t("#PlusInterest").live("click",function(){if(o)return!1;if(o=!0,!(""!=t("#J_BIDMONEY").val()&&t("#J_BIDMONEY").val()>0))return l.tips("请填写出借金额","#J_BIDMONEY",{tips:1}),o=!1,t("#J_BIDMONEY").focus(),l.close(index),!1;Plus_ajaxurl="1"==t("#isPlan").val()?"/index.php?ctl=deal&act=lcplus_interest":"/index.php?ctl=deal&act=plus_interest",l.load(1);var e=new Object;"1"==t("#isPlan").val()?e.plan_id=t.trim(t("#plan_id").val()):e.deal_id=t.trim(t("#deal_id").val()),e.bid_money=t.trim(t("#J_BIDMONEY").val()),e.RedPacket_money=t.trim(t("#PlusInterest").val()),e.r_id=t.trim(t("#PlusInterest_id").val()),t.ajax({url:Plus_ajaxurl,data:e,dataType:"json",type:"POST",success:function(e){l.closeAll("loading"),e.status?(l.open({type:1,area:["598px","500px"],title:"选择加息卡",closeBtn:!1,content:e.page}),o=!1):(l.alert(e.info,{title:"提示",closeBtn:0}),o=!1)},error:function(){l.closeAll("loading"),l.alert(a.REQUEST_DATA_FAILED,{title:"提示",closeBtn:0}),o=!1}})}),t("#select_Coupon li").live("click",function(){t(this).hasClass("selected")?(t(this).find(".mark").addClass("hide"),t(this).removeClass("selected"),t("#selected_interest").html("")):(t(this).addClass("selected"),t(this).find(".mark").removeClass("hide"),t(this).siblings().removeClass("selected").find(".mark").addClass("hide"),t("#selected_interest").html(t(this).attr("interest")))}),t("#confirm_plusInterest").live("click",function(){var e="",a=0,n=0;t("#select_Coupon li").each(function(){t(this).hasClass("selected")&&(e+=t(this).attr("id")+",",a=t(this).attr("day"),n=t(this).attr("interest"))}),""!=t("#selected_interest").html()?(t("#PlusInterest_id").val(e.substring(0,e.length-1)),t("#PlusInterest").val("加息"+n+"%，加息"+a+"天").attr({day:a,interest:n}),l.closeAll()):(t("#PlusInterest_id").val(""),t("#PlusInterest").val(""),l.closeAll()),o=!1,i()}),t("#deal_submit").live("click",function(){if(""==t("#J_BIDMONEY").val()||t("#J_BIDMONEY").val()<=0)return l.tips("请填写出借金额","#J_BIDMONEY",{tips:1}),t("#J_BIDMONEY").focus(),!1;l.load(1);var e=t("#ajax_url").val(),i=new Object;"1"==t("#isPlan").val()?i.plan_id=t("#plan_id").val():i.deal_id=t("#deal_id").val(),i.bid_money=t.trim(t("#J_BIDMONEY").val()),i.red_id=t.trim(t("#RedEnvelope_id").val()),i.interestrate_id=t.trim(t("#PlusInterest_id").val()),t.ajax({type:"post",url:e,data:i,dataType:"json",success:function(e){l.closeAll("loading"),2==e.status?l.alert(e.info,{title:"提示",closeBtn:0},function(){window.location.href=e.jump}):1==e.status?(pc_con=e.pc_con,l.open({type:1,area:["650px","430px"],title:"确认出借",content:e.info})):l.alert(e.info,{title:"提示",closeBtn:0},function(){l.closeAll(),e.jump&&(window.location.href=e.jump)})},error:function(){l.closeAll("loading"),l.alert(a.REQUEST_DATA_FAILED,{title:"错误",icon:2,closeBtn:0})}})}),t("#J_bindpassword_btn").live("click",function(){if(""==t("#J_BIDMONEY").val()||t("#J_BIDMONEY").val()<=0)return l.tips("请填写出借金额","#J_BIDMONEY",{tips:1}),t("#J_BIDMONEY").focus(),!1;l.load(1);var e="/index.php?ctl=deal&act=dobid",i=new Object;"1"==t("#isPlan").val()?i.plan_id=t("#plan_id").val():i.deal_id=t("#deal_id").val(),i.bid_money=t.trim(t("#J_BIDMONEY").val()),i.red_id=t.trim(t("#RedEnvelope_id").val()),i.interestrate_id=t.trim(t("#PlusInterest_id").val()),i.pc_con=pc_con,t.ajax({type:"post",url:e,data:i,dataType:"json",success:function(e){l.closeAll("loading"),2==e.status?l.alert(e.info,{title:"提示",closeBtn:0},function(){window.location.href=e.jump}):1==e.status?(pc_con=e.pc_con,l.alert(e.info,{title:"成功",icon:1,closeBtn:0},function(){window.location.href=e.jump})):3==e.status||(4==e.status?t("body").append(e.msg):l.alert(e.info,{title:"提示",closeBtn:0},function(){l.closeAll(),e.jump&&(window.location.href=e.jump)}))},error:function(){l.closeAll("loading"),l.alert(a.REQUEST_DATA_FAILED,{title:"错误",icon:2,closeBtn:0})}})}),t("#protocol_risk").click(function(){l.open({type:1,area:["800px","650px"],title:"风险提示书",content:t(".protocol_con")})}),t(".protocol_con .closebtn a").live("click",function(){l.closeAll()}),t("area[rel^='prettyPhoto']").prettyPhoto(),t(".gallery:first a[rel^='prettyPhoto']").prettyPhoto({animation_speed:"fast",slideshow:1e4,hideflash:!0});var r=1e3*parseInt(t("#serverTime").val()),d=1e3*parseInt(t("#startTime").val());n()})});