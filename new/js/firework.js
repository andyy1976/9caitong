function initAnimate(){drawBg(),lastTime=new Date,animate()}function animate(){ctx.save(),ctx.globalAlpha=1,ctx.fillStyle="rgba(0,5,24,0.5)",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.restore();var t=new Image;t.src="/new/images/slide/bg8.jpg",ctx.drawImage(t,0,0,canvas.width,canvas.height);var a=new Date;if(a-lastTime>500+(window.innerHeight-767)/2){var i=100*Math.random()>2?!0:!1,e=getRandom(canvas.width/5,4*canvas.width/5),s=getRandom(50,200);if(i){var n=new Boom(getRandom(canvas.width/3,2*canvas.width/3),2,"#FFF",{x:e,y:s});bigbooms.push(n)}else{var n=new Boom(getRandom(canvas.width/3,2*canvas.width/3),2,"#FFF",{x:canvas.width/2,y:200},document.querySelectorAll(".shape")[parseInt(getRandom(0,document.querySelectorAll(".shape").length))]);bigbooms.push(n)}lastTime=a,console.log(bigbooms)}stars.foreach(function(){this.paint()}),drawMoon(),bigbooms.foreach(function(){var t=this;this.dead?this.booms.foreach(function(a){this.dead?a===t.booms.length-1&&(bigbooms[bigbooms.indexOf(t)]=null):this.moveTo(a)}):(this._move(),this._drawLight())}),raf(animate)}function drawMoon(){}function putValue(t,a,i,e,s){a.clearRect(0,0,t.width,t.height);var n=new Image;if(i.innerHTML.indexOf("img")>=0)n.src=i.getElementsByTagName("img")[0].src,imgload(n,function(){a.drawImage(n,t.width/2-n.width/2,t.height/2-n.width/2),dots=getimgData(t,a,e),s(dots)});else{var o=i.innerHTML;a.save();var h=200;a.font=h+"px 宋体 bold",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba("+parseInt(getRandom(128,255))+","+parseInt(getRandom(128,255))+","+parseInt(getRandom(128,255))+" , 1)",a.fillText(o,t.width/2,t.height/2),a.restore(),dots=getimgData(t,a,e),s(dots)}}function imgload(t,a){t.complete?a.call(t):t.onload=function(){a.call(this)}}function getimgData(t,a,i){var e=a.getImageData(0,0,t.width,t.height);a.clearRect(0,0,t.width,t.height);for(var s=[],n=0;n<e.width;n+=i)for(var o=0;o<e.height;o+=i){var h=4*(o*e.width+n);if(e.data[h+3]>128){var r={x:n,y:o,a:e.data[h],b:e.data[h+1],c:e.data[h+2]};s.push(r)}}return s}function getRandom(t,a){return Math.random()*(a-t)+t}function drawBg(){}var canvas=document.getElementById("cas"),ocas=document.createElement("canvas"),octx=ocas.getContext("2d"),ctx=canvas.getContext("2d");ocas.width=canvas.width=window.innerWidth-24,ocas.height=canvas.height=900;var bigbooms=[];window.onload=function(){initAnimate()};var lastTime;Array.prototype.foreach=function(t){for(var a=0;a<this.length;a++)null!==this[a]&&t.apply(this[a],[a])};var raf=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},Boom=function(t,a,i,e,s){this.booms=[],this.x=t,this.y=canvas.height+a,this.r=a,this.c=i,this.shape=s||!1,this.boomArea=e,this.theta=0,this.dead=!1,this.ba=parseInt(getRandom(80,200))};Boom.prototype={_paint:function(){ctx.save(),ctx.beginPath(),ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.fillStyle=this.c,ctx.fill(),ctx.restore()},_move:function(){var t=this.boomArea.x-this.x,a=this.boomArea.y-this.y;this.x=this.x+.01*t,this.y=this.y+.01*a,Math.abs(t)<=this.ba&&Math.abs(a)<=this.ba?(this.shape?this._shapBoom():this._boom(),this.dead=!0):this._paint()},_drawLight:function(){ctx.save(),ctx.fillStyle="rgba(255,228,150,0.3)",ctx.beginPath(),ctx.arc(this.x,this.y,this.r+3*Math.random()+1,0,2*Math.PI),ctx.fill(),ctx.restore()},_boom:function(){var t,a=getRandom(30,200),i=getRandom(0,10)>=5?1:2;1===i&&(t={a:parseInt(getRandom(128,255)),b:parseInt(getRandom(128,255)),c:parseInt(getRandom(128,255))});for(var e=parseInt(getRandom(300,400)),s=0;a>s;s++){2===i&&(t={a:parseInt(getRandom(128,255)),b:parseInt(getRandom(128,255)),c:parseInt(getRandom(128,255))});var n=getRandom(-Math.PI,Math.PI),o=getRandom(0,e)*Math.cos(n)+this.x,h=getRandom(0,e)*Math.sin(n)+this.y,r=getRandom(0,2),c=new Frag(this.x,this.y,r,t,o,h);this.booms.push(c)}},_shapBoom:function(){var t=this;putValue(ocas,octx,this.shape,5,function(a){for(var i=canvas.width/2-t.x,e=canvas.height/2-t.y,s=0;s<a.length;s++){color={a:a[s].a,b:a[s].b,c:a[s].c};var n=a[s].x,o=a[s].y,h=1,r=new Frag(t.x,t.y,h,color,n-i,o-e);t.booms.push(r)}})}};var maxRadius=0,stars=[],Star=function(t,a,i){this.x=t,this.y=a,this.r=i};Star.prototype={paint:function(){ctx.save(),ctx.beginPath(),ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.fillStyle="rgba(255,255,255,"+this.r+")",ctx.fill(),ctx.restore()}};var focallength=250,Frag=function(t,a,i,e,s,n){this.tx=s,this.ty=n,this.x=t,this.y=a,this.dead=!1,this.centerX=t,this.centerY=a,this.radius=i,this.color=e};Frag.prototype={paint:function(){ctx.save(),ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.fillStyle="rgba("+this.color.a+","+this.color.b+","+this.color.c+",1)",ctx.fill(),ctx.restore()},moveTo:function(){this.ty=this.ty+.3;var t=this.tx-this.x,a=this.ty-this.y;this.x=Math.abs(t)<.1?this.tx:this.x+.1*t,this.y=Math.abs(a)<.1?this.ty:this.y+.1*a,0===t&&Math.abs(a)<=80&&(this.dead=!0),this.paint()}};